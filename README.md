# Flight Filtering System

Проект предназначен для фильтрации списка авиаперелётов на основе набора гибко настраиваемых правил, заданных в JSON-формате.

## Основные возможности
- Поддержка различных типов правил фильтрации (по дате вылета, количеству сегментов, длительности пересадок и др.)
- Расширяемая архитектура фильтров
- Работа с динамическими значениями времени через переменные типа `${dateNow + day(2) + hour(3)}`
- Поддержка логического отрицания правил (`negate: true`)
- Простая структура данных: `Flight`, `Segment`


## Формат входных данных

### JSON с перелётами (`flights.json`):
```json
[
  {
    "segments": [
      { "departure": "2025-04-02T13:00", "arrival": "2025-04-02T14:00" },
      { "departure": "2025-04-02T14:30", "arrival": "2025-04-02T16:00" }
    ]
  },
  ...
]
```

### JSON с правилами (`rules.json`):
```json
[
  {
    "name": "Рейсы в будущем",
    "description": "Отфильтровывает рейсы, у которых последнее прибытие позже текущего момента времени.",
    "rules": [
      {
        "params": {
          "field": "arrival",
          "operator": ">",
          "value": "${dateNow}"
        }
      }
    ]
  }
]
```

## Поддерживаемые поля и операторы

| Поле               | Описание                                |
|--------------------|------------------------------------------|
| `departure`        | Время вылета первого сегмента            |
| `arrival`          | Время прибытия последнего сегмента       |
| `segmentCount`     | Количество сегментов                     |
| `groundTime`       | Время между сегментами (пересадки)       |
| `totalFlightDuration` | Время между вылетом и финальным прилётом |

### Операторы сравнения
- `>` — больше
- `<` — меньше
- `>=`, `<=`, `==`, `!=`

## Переменные времени
Можно указывать значение как переменную:
```
${dateNow + day(2) + hour(3)}
```
Поддерживаются единицы: `day`, `hour`, `min`, `sec`, `week`, `month`

## Тестирование
В проекте реализован набор юнит-тестов JUnit5, покрывающих:
- Правильность фильтрации (`CorrectResultTest`)
- Логику отдельных компонентов (`RuleConfigTest`, `FieldComparisonFilterTest`, и др.)
- Разбор JSON (`JsonParserTest`, `JsonFlightParserTest`, `RuleSetParserTest`)

## Как запустить

### Через IDE
1. Откройте проект в IntelliJ IDEA
2. Запустите `Main.java`

### Через консоль
```bash
javac -d out src/**/*.java
java -cp out com.gridnine.testing.Main
```

## Требования
- Java 17
- JUnit 5 для тестов


## Язык фильтрации правил

Система правил поддерживает декларативный язык фильтрации на основе JSON:

- Каждое правило — это объект с ключом `params`, содержащим поля `field`, `operator`, `value`
- Один объект `rules` содержит список таких `params`, и они объединяются по логике "и" (AND)
- Значения могут быть:
    - Константами (например, `240`, "2025-04-01T12:00")
    - Переменными (`${dateNow}`) с возможностью арифметики
- Можно указать `negate: true` для логического отрицания фильтра

### Поддерживаемые единицы времени в переменных:
- `day`, `hour`, `min`, `sec`, `week`, `month`

### Пример 1: одно правило с арифметикой времени
```json
{
  "rules": [
    {
      "params": {
        "field": "departure",
        "operator": ">",
        "value": "${dateNow + day(1) + hour(6)}"
      }
    }
  ]
}
```

### Пример 2: два правила в группе
```json
{
  "rules": [
    {
      "params": {
        "field": "departure",
        "operator": ">",
        "value": "${dateNow + day(1)}"
      }
    },
    {
      "params": {
        "field": "segmentCount",
        "operator": ">",
        "value": 1
      }
    }
  ]
}
```

$1

---

## Авторы
Разработано в рамках учебного проекта "Летающий самолётик".

```
        __|__
--@--@--(_)--@--@--
     \   ^__^
      \  (x__x)\_______
         (______)\     )\/\
             ||----w |
             ||     ||
       (Аварийное приземление выполнено успешно)
```

